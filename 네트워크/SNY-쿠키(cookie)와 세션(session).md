# 쿠키(cookie)와 세션(session)

<br>

## 쿠키와 세션을 사용하는 이유

쿠키와 세션은 HTTP 프로토콜의 특징이자 약점을 보완하기 위해 사용된다.

#### (1) 비연결성(Connectionless)

클라이언트가 서버에 요청(Request)을 했을 때, 그 요청에 맞는 응답(Response)을 보낸 후 연결을 끊는 처리 방식이다.

- HTTP 1.1 버전에서 연결을 유지하고, 재활용하는 기능이 Default로 추가되었다. (keep-alive 값으로 변경 가능)

<br>

#### (2) 무상태성(Stateless)

서버와 클라이언트 사이의 통신이 끝나면 상태를 유지하지 않는, 즉 클라이언트의 상태 정보를 가지지 않는 처리 방식이다.

클라이언트와 첫번째 통신에서 데이터를 주고 받았다 해도, 두번째 통신에서 이전의 데이터를 유지하지 않는다.

<br>

그러나, 실제로는 데이터 유지가 필요한 경우가 많다.

상태가 유지되지 않으면, 매번 클라이언트를 확인하기 위해 인증을 반복해야하거나, 상품을 선택했는데 구매 페이지에서 선택한 상품의 정보가 없는 등의 상황이 발생한다. 

따라서 이러한 **HTTP 프로토콜의 특성으로 생기는 단점을 해결하기 위해 쿠키와 세션을 사용**한다. 

클라이언트와 **정보를 유지하기 위해 사용하는 것이 쿠키와 세션**이고, 더 자세한 개념은 아래에서 살펴보자.

<br>

<br>

## 쿠키(Cookie)

- 쿠키(cookie)는 클라이언트 **로컬**에 저장되는 키와 값이 들어있는 작은 데이터 파일
- HTTP의 일종으로, 사용자가 어떠한 웹 사이트를 방문할 경우, 그 사이트가 사용하고 있는 서버에서 **사용자의 컴퓨터에 저장하는 작은 기록 정보 파일**
- 사용자 인증이 유효한 시간을 명시할 수 있으며, 유효 시간이 정해지면 브라우저가 종료되어도 인증이 유지
- 쿠키는 **클라이언트의 상태 정보를 로컬에 저장해두었다가 필요 시 참조하거나 재사용**
- Response Header에 Set-Cookie 속성을 사용하면 클라이언트에 쿠키를 만들 수 있음
- 쿠키는 사용자가 따로 요청하지 않아도 브라우저가 Request 시 Request Header를 넣어서 자동으로 서버에 전송

<br>

### 쿠키의 구성 요소

- 이름 : 각각의 쿠키를 구별하는 데 사용되는 이름
- 값 : 쿠키의 이름과 관련된 값
- 유효시간 : 쿠키의 유지시간(만료일)
- 도메인 : 쿠키를 전송할 도메인
- 경로 : 쿠키를 전송할 요청 경로

<br>

### 쿠키의 동작 순서

<img src="https://t1.daumcdn.net/cfile/tistory/241EE049582DA37607" width=500/>

1. 클라이언트가 페이지를 요청한다(사용자가 웹 사이트 접근).
2. 웹 서버는 쿠키를 생성한다.
3. 생성한 쿠키에 정보를 담아 HTTP 화면을 돌려줄 때, 함께 클라이언트에게 돌려준다.
4. 동일 사이트에 재 방문시 클라이언트의 PC에 해당 쿠키가 있는 경우, 요청 페이지와 함께 쿠키를 전송한다.

<br>

### 쿠키를 사용한 로그인 처리

서버에서 로그인 성공 시 쿠키를 담아 브라우저에 전달하면 브라우저는 해당 쿠키를 저장해두고 

해당 사이트에 접속할 때마다 지속해서 해당하는 쿠키를 보내준다. 

<img src="https://oopy.lazyrockets.com/api/v2/notion/image?src=https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F0f9cec0d-c9cc-4f0c-aa2c-9772c32ce4ef%2FUntitled.png&blockId=4a0cf166-3cb3-405c-b0ec-41dbae97ff75" width=300/> <img src="https://oopy.lazyrockets.com/api/v2/notion/image?src=https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F04be33e7-dcd9-4616-8a02-a3233b2f5808%2FUntitled.png&blockId=51386d89-f9dd-4d55-bb66-33ffc0e329ff" width=400/>

로그인시 쿠키 생성                                                       클라이언트에서 쿠키 전달



<br>

#### 사용 예시

- 방문했던 사이트에 다시 방문하였을 때 아이디와 비밀번호 자동 입력
- 팝업창을 통해 "일주일 간 이 창을 다시 보지 않기" 체크

<br>

<br>

## 세션(Session)

- 세션은 쿠키에 기반하고 있지만, 사용자 정보 파일을 브라우저에 저장하는 쿠키와 달리, **세션은 서버 측에서 관리**

- **방문자가 웹 서버에 접속해있는 상태를 하나의 단위로 보고 그것을 세션**이라 함
- 서버에서는 클라이언트를 구분하기 위해 세션 ID를 부여하며, 웹 브라우저가 **서버에 접속해서 브라우저를 종료할 때 까지 인증상태를 유지**
- 사용자에 대한 정보를 서버에 두기 때문에 **쿠키보다 보안에 좋으나, 사용자가 많아질 수록 서버 메모리를 많이 차지**(즉, 동접자 수가 많은 웹 사이트인 경우 서버에 과부하를 주게 되므로 성능 저하의 요인이 됨)
- 클라이언트가 Request를 보내면, 해당 서버의 엔진이 클라이언트에게 유일한 ID를 부여하는데, 이것이 세션ID이다.

<br>

### 세션의 특징

- 각 클라이언트에게 **고유 Session ID**를 부여하고, 이로 클라이언트를 구분하여, 클라이언트의 요구에 맞는 서비스를 제공
- 브라우저를 닫거나, 서버에서 세션을 삭제했을 때만 삭제 되므로, **보안 면에서 쿠키보다 우수**
- (서버 용량이 허용하는 한) 저장 데이터에 제한이 없음

- 웹 서버에 저장되는 쿠키( = 세션 쿠키)

<br>

### 세션의 동작 순서

<img src="https://raw.githubusercontent.com/na3150/typora-img/main/img/image-20221202221821524.png" width=700/>

1. 클라이언트가 페이지를 요청한다(사용자가 웹 사이트 접근).
2. 서버는 접근한 클라이언트의 Request-Header 필드인 Cookie를 확인하여, 클라이언트가 해당 session-id를 보냈는지 확인한다.
3. session-id가 존재하지 않는다면, 서버는 session-id를 생성하고, 사용자 ID와 매핑 정보를 저장한다.
4. **클라이언트가 세션ID를 쿠키로 저장**하도록 클라이언트에게 전달한다.
5. 이후 클라이언트는 재접속 시, 4번의 쿠키를 이용하여 session-id 값을 서버에 전달한다. 서버는 세션ID를 확인하고, 세션ID와 매핑디는 ID의 사용자로 인식한다.

<br>

### 세션을 통한 로그인 처리



<img src="https://youhavetosleep.dev/static/165cc0dae6c870f113dcf191ea853211/0ede0/session-1.jpg" width=500/>



1. 사용자가 웹 사이트에서 ID, Password를 입력하여 서버에 로그인 요청을 보낸다.
2. 서버는 DB를 확인하여 일치한다면 세션 객체를 생성하고 세션 ID를 부여한 뒤 서버 메모리에 저장한다.
3. 로그인 요청의 응답으로 쿠키에 세션ID를 담아 사용자에게 보낸다.
4. 사용자가 요청을 보낼 때 쿠키에 세션ID를 담아 요청을 보낸다.
5. 서버에선 로그인 정보를 다시 확인하지 않고 세션ID를 통해 확인한다.
6. 세션 ID가 유효하다면 해당 요청의 응답을 사용자에게 보낸다.

<br>

### 세션의 사용

세션은 서버의 자원을 사용하기 때문에 무분별하게 만들다보면 서버의 메모리가 감당할 수 없어질 수 있고, 속도가 느려질 수 있기 때문에 상황에 적합하게 세션을 사용해야한다. 세션이 쿠키에 비해 보안이 높은 편이나 쿠키를 사용하는 것은 이러한 이유 때문이고, 자원관리 차원에서 쿠키와 세션을 적절한 요소 및 기능에 병행 사용하여, 서버 자원의 낭비를 방지하며 웹사이트의 속도를 높일 수 있다.

<br>

#### 사용 예시

- 화면이 이동해도 로그인이 해제되지 않고, 로그아웃하기 전까지 유지

<br>

<br>

## 쿠키와 세션의 차이

- 쿠키는 서버의 자원을 전혀 사용하지 않으며, 세션은 서버의 자원을 사용한다.
- 보안 면에서 세션이 더 우수하며, 요청 속도는 쿠키가 세션보다 빠르다(세션은 서버의 처리가 필요하기 때문).
- 쿠키는클라이언트 로컬에 저장되어, 변질되거나 request에서 스니핑 당할 우려가 있어 보안에 취약하지만, 세션은 쿠키를 이용하여 session-id만 저장하고, session-id로 구분해서 서버에서 처리하기 때문에 비교적 보안성이 좋다.
- 쿠키도 만료 시간이 있지만 파일로 저장되기 때문에 브라우저를 종료해도 계속해서 정보가 남아있을 수 있다. 또한 만료기간을 넉넉하게 잡아두면 쿠키를 삭제할 대까지 유지될 수도 있다. 반면에 세션은 만료 시간을 정할 수 있지만 브라우저가 종료되면 만료시간에 상관없이 삭제된다.

|                           | 쿠키(Cookie)                                                 | **세션(Session)**                     |
| ------------------------- | ------------------------------------------------------------ | ------------------------------------- |
| **저장 위치**             | 클라이언트(=접속자 PC)                                       | 웹 서버                               |
| **저장 형식**             | text                                                         | Object                                |
| **만료 시점**             | 쿠키 저장시 설정 (브라우저가 종료되도, 만료시점이 지나지 않으면 자동삭제되지 않음) | 브라우저 종료시 삭제 (기간 지정 가능) |
| **사용하는 자원(리소스)** | 클라이언트 리소스                                            | 웹 서버 리소스                        |
| **용량 제한**             | 총 300개 하나의 도메인 당 20개 하나의 쿠키 당 4KB(=4096byte) | 서버가 허용하는 한 용량제한 없음.     |
| **속도**                  | 세션보다 빠름                                                | 쿠키보다 느림                         |
| **보안**                  | 세션보다 안좋음                                              | 쿠키보다 좋음                         |

<br>

<br>

## 기술 질문/예상 질문

<details>
<summary>쿠키와 세션에 대해서 설명해 주세요.</summary>




<br>

쿠키와 세션은 HTTP 프로토콜의 특징이자 약점을 보완하기 위해 사용되는 것으로, 

- 쿠키 : 사용자의 컴퓨터에 저장하는 작은 기록 정보 파일

- 세션 : 서버의 메모리에 저장되며, 서버에 접속해서 브라우저를 종료할 때 까지 인증상태를 유지

</details>

<br>

<details>
<summary>쿠키와 세션의 차이에 대해서 설명해주세요.</summary>




<br>

쿠키와 세션의 가장 큰 차이점은 정보가 저장되는 위치입니다. 쿠키는 클라이언트 측에서, 세션은 서버 측에서 저장되고 관리됩니다. 사용자의 편의를 위하되, 지워지거나 가로채거나 했을 때 큰 문제가 생기지 않을 만한 정보들은 쿠키에, 사용자나 다른 누군가에게 노출되어서는 안되고 서비스 제공자가 직접 관리해야하는 정보는 세션에 저장되게 됩니다. 

다만, 모두 세션에 저장하게 된다면 접속자가 많을 때 서버에 부담이 커지므로, 개발자의 판단하에 적절하게 분배해서 저장해두어야 합니다.

</details>

<br>

<br>

<br>

<br>

<br>

<br>

Reference

- https://hyeminnoh.github.io/Tech-Stack/Network/Cookie_and_Session.html#_1-%EC%BF%A0%ED%82%A4%EC%99%80-%EC%84%B8%EC%85%98%EC%9D%84-%EC%99%9C-%EC%82%AC%EC%9A%A9%ED%95%A0%EA%B9%8C
- https://hahahoho5915.tistory.com/32

- https://www.google.com/url?sa=i&url=https%3A%2F%2Finterconnection.tistory.com%2F74&psig=AOvVaw1Yrvf68JmS67cUyCtew-xA&ust=1670071480570000&source=images&cd=vfe&ved=0CBAQjRxqFwoTCICSpaD72vsCFQAAAAAdAAAAABAJ

- https://catsbi.oopy.io/0c27061c-204c-4fbf-acfd-418bdc855fd8

- https://youhavetosleep.dev/session/