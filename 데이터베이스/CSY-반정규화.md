### **정규화의 문제점**

- 정규화는 데이터 조회(select) 시에 조인(join)을 유발하기 때문에 CPU와 메모리를 많이 사용한다

```sql
select 사원번호, 부서코드, 부서명, 이름, 전화번호, 주소
from 직원 inner join 부서 on직원.부서코드=부서.부서코드;
```

---

## 반정규화란?

- 데이터베이스의 성능 향상을 위하여, 데이터 중복을 허용하고 조인을 줄이는 데이터베이스 성능 향상 방법이다.
- 반정규화는 **조회(SELECT) 속도를 향상**시키지만, **데이터 모델의 유연성은 낮아진다**.

### 반정규화를 수행하는 경우

- 정규화에 충실하여 종속성, 활용성은 향상되었지만, 수행 속도가 느려진 경우
- 다량의 범위를 자주 처리해야하는 경우
- 특정 범위의 데이터만 자주 처리하는 경우
- 요약/집계 정보가 자주 요구되는 경우

## 반정규화 절차

| 반정규화 절차 | 설명 |
| --- | --- |
| 대상 조사 및 검토 | 데이터 처리 범위, 통계성 등을 확인해서 반정규화 대상을 조사한다. |
| 다른 방법 검토 | - 반정규화를 수행하기 전에 다른 방법이 있는지 검토한다.
- 예를 들어 클러스터링, 뷰, 인덱스 튜닝, 응용 프로그램, 파티션 등을 검토한다. |
| 반정규화 수행 | 테이블, 속성, 관계 등을 반정규화한다. |

```
[Clustering?]
- 클러스터링 인덱스라는 것은 인덱스 정보를 저장할 때, 물리적으로 정렬해서 저장하는 방법이다.
- 따라서 조회 시에 인접 블록을 연속적으로 읽기 때문에 성능이 향상된다.
```

## 반정규화 기법

### 중복 속성 추가

- 중복 속성 추가는 조인해서 데이터를 처리할 때 데이터를 조회하는 경로를 단축하기 위해 자주 사용하는 속성을 하나 더 추가하는 것이다.
- 중복 속성을 추가하면 데이터의 무결성 확보가 어렵고, 디스크 공간이 추가로 필요
- 중복 속성을 추가하는 경우
    - 조인이 자주 발생하는 속성
    - 접근 경로가 복잡한 속성
    - 액세스의 조건으로 자주 사용되는 속성
    - 기본키의 형태가 적절하지 않거나 여러 개의 속성으로 구성된 경우
- 중복 속성 추가 시 고려 사항
    - 테이블 중복과 속성의 중복 고려
    - 데이터 일관성 및 무결성에 유의
    - SQL 그룹 함수를 이용하여 처리할 수 있어야 함
    - 저장 공간의 지나친 낭비 고려

### **중복 테이블 추가**

여러 테이블에서 데이터를 추출해서 사용해야 하거나 다른 서버에 저장된 테이블을 이용해야 하는 경우 중복 테이블을 추가하여 작업의 효율성을 향상시킬 수 있다.

- 중복 테이블을 추가하는 경우
    - 정규화로 인해 수행 속도가 느려지는 경우
    - 많은 범위의 데이터를 자주 처리해야 하는 경우
    - 특정 범위의 데이터만 자주 처리해야 하는 경우
    - 처리 범위를 줄이지 않고는 수행 속도를 개선할 수 없는 경우
- 중복 테이블을 추가하는 방법
    - **집계 테이블**의 추가 : 집계 데이터를 위한 테이블을 생성하고, 각 원본 테이블에 트리거를 설정하여 사용하는 것으로, 트리거 오버헤드에 유의해야 함
    - **진행 테이블**의 추가 : 이력 관리 등의 목적으로 추가하는 테이블로, 적절한 데이터 양의 유지와 활용도를 높이기 위해 기본키를 적절히 설정
    - **특정 부분만을 포함하는 테이블**의 추가 : 데이터가 많은 테이블의 특정 부분만을 사용하는 경우 해당 부분만으로 새로운 테이블을 생성

![집계 테이블 예시](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/e498f5fa-f064-4048-9db7-16b05f54838b/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20230319%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20230319T094405Z&X-Amz-Expires=86400&X-Amz-Signature=d3b52b6db8f1f1ade3027eb24f260650cdaad30db34382f5e753f9944aadf920&X-Amz-SignedHeaders=host&response-content-disposition=filename%3D%22Untitled.png%22&x-id=GetObject)

집계 테이블 예시

### 테이블 분할

**수평 분할**

- 수평 분할은 레코드를 기준으로 테이블을 분할하는 것
- 레코드별로 사용 빈도의 차이가 큰 경우 사용 빈도에 따라 테이블을 분할함

**수직 분할**

- 수직 분할은 하나의 테이블에 속성이 너무 많을 경우 속성을 기준으로 테이블을 분할하는 것
- 갱신 위주의 속성 분할 : 데이터 갱신 시 레코드 잠금으로 인해 다른 작업을 수행 할 수 없으므로 갱신이 자주 일어나는 속성들을 수직 분할하여 사용
- 자주 조회되는 속성 분할 : 자주 조회되는 속성이 극히 일부일 경우 그 속성들을 수직 분할하여 사용
- 크기가 큰 속성 분할 : 이미지나 2GB 이상 저장될 수 있는 텍스트 형식 등으로 된 속성들을 수직 분할하여 사용
- 보안을 적용해야하는 속성 분할 : 특정 속성에 대해 보안을 적용할 수 없으므로 보안을 적용해야 하는 속성들을 수직 분할하여 사용

**테이블 분할 시 고려 사항**

- 기본키의 유일성 관리가 어려워짐
- 데이터 양이 적거나 사용 빈도가 낮은 경우 테이블 분할이 필요한지를 고려해야 함
- 분할된 테이블로 인해 수행 속도가 느려질 수 있음
- 데이터 검색에 중점을 두어 테이블 분할 여부를 결정

![수직분할-갱신](https://s3.us-west-2.amazonaws.com/secure.notion-static.com/a4c7d853-4a18-4727-888b-c79b8c1ac209/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20230319%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20230319T094549Z&X-Amz-Expires=86400&X-Amz-Signature=3e8fe8e89428048d0746d1e35e5cb740b1f53bfbd1e5501c4281f4816b611390&X-Amz-SignedHeaders=host&response-content-disposition=filename%3D%22Untitled.png%22&x-id=GetObject)

수직분할-갱신

### **테이블 통합**

테이블 통합은 두 개의 테이블이 조인되는 경우가 많아 하나의 테이블로 합쳐 사용하는 것이 성능 향상에 도움이 될 경우 수행한다.

- 두 개의 테이블에서 발생하는 프로세스가 동일하게 자주 처기되는 경우, 두 개의 테이블을 이용하여 항상 조회를 수행하는 경우 테이블 통합을 고려
- 테이블 통합의 종류에는 1:1 관계 테이블 통합, 1:N 관계 테이블 통합, 슈퍼타입/서브타입 테이블 통합이 있음
- 테이블 통합 시 고려 사항
    - 데이터 검색은 간편하지만 레코드 증가로 인해 처리량이 증가
    - 테이블 통합으로 인해 입력, 수정, 삭제 규칙이 복잡해질 수 있음
    - Not Null, Default, Check 등의 제약조건을 설계하기 어려움

## 예상 질문

- 반정규화란 무엇인가?
    
    **반정규화**는 성능 향상을 위해 중복,통합을 하는 기법이다.
    
    조인으로 인한 성능 저하가 예상되는 경우 반정규화를 실행한다.
    
    반정규화를 과도하게 적용하면 무결성이 깨질수있다.
    
- 반정규화 기법의 종류엔 무엇이 있는가?
    
    중복 속성 추가, 중복 테이블 추가, 테이블 분할, 테이블 병합이 있습니다.
    
- 반정규화를 진행했을 때 단점은 무엇인가?
    
    반정규화는 조회(SELECT) 속도를 향상시키지만, 데이터 모델의 유연성은 낮아진다는 단점이 있습니다.
    

## 참고 자료

- [https://lipcoder.tistory.com/337](https://lipcoder.tistory.com/337)
- [집계 테이블](https://m.cafe.daum.net/dbmsclub/Sql7/44?svc=cafeapi)
