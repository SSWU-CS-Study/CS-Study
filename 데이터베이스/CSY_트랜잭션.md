## 트랜잭션(Transaction)

> 데이터베이스의 상태를 변화시키기 위해 수행하는 작업 단위
하나의 논리적 작업 단위를 구성하는 일련의 연산들의 집합

- 계좌 간의 자금 이체
    
    한 계좌에서 10만 원을 인출하여 다른 계좌로 10만 원 입금하는 이체 작업은 
    전체 작업이 정상적으로 완료되거나, 
    만약 정상적으로 처리될 수 없는 경우에는 아무 것도 실행되지 않은 처음 상태로 되돌려져야 한다.
    이러한 트랜잭션은 다양한 데이터 항목들을 액세스하고 갱신하는 프로그램 수행의 단위가 된다.
    
    ```markdown
    * 이때 DB 작업
    - 1. 사용자 A의 계좌에서 만원을 차감한다 : UPDATE 문을 사용해 사용자 A의 잔고를 변경
    - 2. 사용자 B의 계좌에 만원을 추가한다 : UPDATE 문을 사용해 사용자 B의 잔고를 변경
    
    현재 작업 단위 : 출금 UPDATE문 + 입금 UPDATE문
    → 이를 통틀어 하나의 트랜잭션이라고 한다.
    - 위 두 쿼리문 모두 성공적으로 완료되어야만 "하나의 작업(트랜잭션)"이 완료되는 것이다. `Commit`
    - 작업 단위에 속하는 쿼리 중 하나라도 실패하면 모든 쿼리문을 취소하고 이전 상태로 돌려놓아야한다. `Rollback`
    ```
    
<br />

## 트랜잭션의 특징(ACID)

- 원자성(Atomicity)
    
    트랜잭션이 DB에 모두 반영되거나, 혹은 전혀 반영되지 않아야 된다.
    
- 일관성(Consistency)
    
    트랜잭션의 작업 처리 결과는 항상 일관성 있어야 한다.
    
- 독립성(Isolation)
    
    둘 이상의 트랜잭션이 동시에 병행 실행되고 있을 때, 어떤 트랜잭션도 다른 트랜잭션 연산에 끼어들 수 없다.
    
- 지속성(Durability)
    
    트랜잭션이 성공적으로 완료되었으면, 결과는 영구적으로 반영되어야 한다.
    
<br />

### **Commit**

하나의 트랜잭션이 성공적으로 끝났고, DB가 일관성있는 상태일 때 이를 알려주기 위해 사용하는 연산

### **Rollback**

하나의 트랜잭션 처리가 비정상적으로 종료되어 트랜잭션 원자성이 깨진 경우

transaction이 정상적으로 종료되지 않았을 때, last consistent state (예) Transaction의 시작 상태) 로 roll back 할 수 있음.

![[https://devuna.tistory.com/30](https://devuna.tistory.com/30)](https://k.kakaocdn.net/dn/PDxus/btqB2uxivzk/ERRntkdAzfbibpUlXmtohK/img.png)

[https://devuna.tistory.com/30](https://devuna.tistory.com/30)

- 활동(Active) : 트랜잭션의 활동 상태. 트랜잭션이 실행중이며 동작중인 상태를 말한다.
- 부분완료(Partially Committed) : 트랜잭션의 Commit 명령이 도착한 상태. 트랜잭션의 commit 이전 sql문이 수행되고 commit만 남은 상태를 말한다.
설계자의 최종 승인(Commit*)이 있을 때 까지 실제 데이터베이스에 작업 내용을 반영하지 않고 기다리고 있는 상태이다.
- 완료(Committed) : 트랜잭션 완료 상태. 트랜잭션이 정상적으로 완료된 상태를 말한다.
- 실패(Failed) : 트랜잭션 실패 상태. 트랜잭션이 더 이상 정상적으로 진행될 수 없는 상태를 말한다.
- 취소(Aborted) : 트랜잭션 취소 상태. 트랜잭션이 취소되고 트랜잭션 실행 이전 데이터로 돌아간 상태를 말한다.


<br />
<br />

## 예상 질문

<details>
  <summary>트랜잭션이란?</summary>
  <div markdown="1">
    데이터베이스의 상태를 변화시키기 위하여 , 논리적인 기능을 수행하는 하나의 작업단위 또는 한꺼번에 모두 수행되어야 하는 연산들입니다. <br />

    데이터베이스의 완전성을 보장하기 위한것이 목적입니다.
  </div>
</details>

<details>
  <summary>트랜잭션의 특성을 설명하세요.</summary>
  <div markdown="1">
    
- 원자성(Atomicity) : 트랜잭션의 연산은 데이터베이스에 모두 반영되든지 아니면 전혀 반영되지 않아야 함
- 독립성(Isolation) : 실행중에 있는 연산의 중간 결과에 다른 트랜잭션이 접근할 수 없음
- 일관성(Consistency) : 실행을 성공적으로 완료하면 언제나 일관성있는 데이터베이스 상태로 변환함
- 지속성(Durability) : 일단 실행이 성공적으로 완료 되면 결과는 지속적이어야 함

- commit : 정상적으로 처리되어서 트랜잭션이 반영된 상태
- rollback : 취소하거나 정상적으로 이루어지지 않을 때 이전 상태로 돌아가는 것
  </div>
</details>
